---
- name: Install HashiCorp Vault on RHEL
  hosts: all
  become: yes
  gather_facts: yes

  tasks:

    - name: Add HashiCorp repository
      ansible.builtin.yum_repository:
        name: hashicorp
        description: "HashiCorp Stable - $basearch"
        baseurl: "https://rpm.releases.hashicorp.com/RHEL/$releasever/$basearch/stable"
        gpgkey: "https://rpm.releases.hashicorp.com/gpg"
        gpgcheck: true
        enabled: true
        state: present

    - name: Install required packages
      ansible.builtin.dnf:
        name:
          - yum-utils
        state: present
        update_cache: yes

    - name: Install vault
      ansible.builtin.dnf:
        name:
          - vault
        state: present

    - name: Verify vault installation
      ansible.builtin.command:
        cmd: vault --version
      register: vault_version
      changed_when: false

    - name: Print vault version
      ansible.builtin.debug:
        msg: "Vault version: {{ vault_version.stdout }}"
